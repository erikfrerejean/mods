<!-- IF S_KEYWORD_VERSION -->
<!--
/**
 *
 * @author Erik Frèrejean
 *
 * @package Subject Prefix
 * @copyright (c) 2010 Erik Frèrejean ( erikfrerejean@phpbb.com ) http://www.erikfrerejean.nl
 * @license http://opensource.org/licenses/gpl-license.php GNU Public License
 *
 */
//-->
<!-- ENDIF -->

<!-- INCLUDE overall_header.html -->

<h1>{L_ACP_SUBJECT_PREFIX}</h1>
<p><!-- IF .forumrow -->{L_ACP_SUBJECT_PREFIX_EXPLAIN}<!-- ELSE -->{L_NO_PREFIXES}<!-- ENDIF --></p>

<div class="successbox" style="display: none;">
    <h3>{L_INFORMATION}</h3>
    <p>{L_PREFIX_ORDER_UPDATED}</p>
</div>

<!-- BEGIN forumrow -->
    <table cellspacing="1" id="prefixrowbody{forumrow.FORUM_ID}">
	<thead>
	    <tr class="nodrag">
		<th>{forumrow.FORUMNAME}</th>
		<th>{L_OPTIONS}</th>
	    </tr>
	</thead>
	<tbody class="prefixrowbody">
	    <!-- BEGIN prefixrow -->
	    <tr id="{forumrow.FORUM_ID}.{prefixrow.PREFIX_ID}" class="<!-- IF prefixrow.S_ROW_COUNT is odd -->row2<!-- ELSE -->row1<!-- ENDIF -->">
		<td>{prefixrow.PREFIX_NAME}</td>
		<td style="width: 80px; text-align: right; white-space: nowrap">
		    <span class="moveButtons">
		    <!-- IF prefixrow.S_FIRST_ROW && not prefixrow.S_LAST_ROW -->
			{ICON_MOVE_UP_DISABLED}
			<a href="{prefixrow.U_MOVE_DOWN}">{ICON_MOVE_DOWN}</a>
		    <!-- ELSEIF not prefixrow.S_FIRST_ROW && not prefixrow.S_LAST_ROW -->
			<a href="{prefixrow.U_MOVE_UP}">{ICON_MOVE_UP}</a>
			<a href="{prefixrow.U_MOVE_DOWN}">{ICON_MOVE_DOWN}</a>
		    <!-- ELSEIF not prefixrow.S_FIRST_ROW && prefixrow.S_LAST_ROW -->
			<a href="{prefixrow.U_MOVE_UP}">{ICON_MOVE_UP}</a>
			{ICON_MOVE_DOWN_DISABLED}
		    <!-- ENDIF -->
		    </span>
		    <a href="{prefixrow.U_EDIT}">{ICON_EDIT}</a>
		    <a href="{prefixrow.U_DELETE}">{ICON_DELETE}</a>
		</td>
	    </tr>
	    <!-- END prefixrow -->
	</tbody>
    </table>
<!-- END forumrow -->

<script type="text/javascript" src="style/subject_prefix.js"></script>
<script type="text/javascript">
var cookieName = 'acpprefixcollapsed';

$(document).ready(function() {
    // Hide all tables
    $('#main > table').each(function(index) {
	hidePrefixTable(this);

	// Bind the onclick to the th
	$('thead > tr > th:first', this).click(function() {
	    displayPrefixTable(this);
	});

	// The move buttons break due to the drag-drop stuff, disable them
	$('.moveButtons', this).remove();
	$('.moveButtons', this).parent().css('width', 40);

	// Init drag-drop
	$(this).tableDnD({
	    onDragClass	: 'row3',
	    onDrop	: function(table, row) {
		// Fix row colouring
		var rowClassCorrect	= '';
		var rowClassIncorrect	= '';

		$('tbody > tr', table).each(function(index) {
		    rowClassCorrect	= (index % 2 == 0) ? 'row1' : 'row2';
		    rowClassIncorrect	= (index % 2 == 0) ? 'row2' : 'row1';

		    //alert (rowClassCorrect + "\t" + rowClassIncorrect + "\n" + $(this).attr('class'));
		    // If incorrect class remove the class.
		    if ($(this).hasClass(rowClassIncorrect))
		    {
			$(this).removeClass(rowClassIncorrect);
		    }

		    // If needed assign the new class
		    if ($(this).hasClass(rowClassCorrect) == false)
		    {
			$(this).addClass(rowClassCorrect);
		    }
		});

		// Now send this change to the server so we can store it ^^
		$.ajax({
		    type    : 'POST',
		    url     : '{U_SUBJECT_PREFIX_AJAX_REQUEST}&tablename=' + $(table).attr('id'),
		    data    : $.tableDnD.serialize(),
		    success : function(html) {
			// Show the message
			if (html == 'success')
			    $('.successbox').show();
		    },
		});
	    },
	});
    });

    // Can I haz cookie
    var showObject = null;
    var cookie = $.cookie(cookieName);
    if (!cookie)
    {
	showObject = $('#main table:first');
    }
    else
    {
	// Yes, restore the last displayed list
	showObject = $('#main > #' + cookie);
    }
    displayPrefixTable(showObject, true);
});

function hidePrefixTable(ele)
{
    // Hide the options column
    $('thead > tr > th:gt(0)', ele).hide();

    // Hide the body
    $('tbody', ele).hide();
}

function displayPrefixTable(ele, fromCookie)
{
    // Hide all others
    $('#main > table').each(function(index) {
	hidePrefixTable(this);
    });

    // Get the table
    if (fromCookie != null)
	var table = ele;
    else
	var table = $(ele).parent().parent().parent();

    // Display the options column
    $('thead > tr > th:gt(0)', table).show();

    // Display the box
    $('tbody', table).show();

    // I love rock n' roll
    // So put another cookie in the jukebox, baby
    // I love rock n' roll
    // So come and take your time and dance with me
    var selected = $(table).attr('id');
    $.cookie(cookieName, selected, { expires: 365, path: "/" });
}
</script>

<!-- INCLUDE overall_footer.html -->
